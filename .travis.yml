language: php
sudo: false
php: 7.1

env:
  global:
    -THUNDER=`echo ${TRAVIS_BUILD_DIR}"/../thunder"`
    -THEME=`echo ${THUNDER}"/docroot/themes/contrib/thunder_admin/"`
    -PATH="$THUNDER/bin:$PATH"
  matrix:
    - SHARPEYE_BROWSER=chrome
    - SHARPEYE_BROWSER=firefox

branches:
  only:
    - /8\.x-[0-9]+\.x/

cache:
  apt: true
  directories:
    - "$HOME/.composer/cache"
    - "$HOME/.drush/cache"

services:
  - docker

addons:
  artifacts:
    region: eu-west-1
    paths:
      - /tmp/sharpeye
  apt:
    packages:
      - graphicsmagick

before_install:
  - git clone https://github.com/thunder/thunder-admin-tests.git -b feature/genericize-travis-scripts ./tests
  - bash -x -e ./tests/scripts/before-install.sh

install:
  - bash -x -e ./tests/scripts/install.sh

before_script:
  - bash -x -e ./tests/scripts/before-script.sh

script:
  - bash -x -e ./tests/scripts/build.sh
  - bash -x -e ./tests/scripts/visual.sh